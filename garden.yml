kind: Project
name: cache-service
environments:
  - name: local
    providers:
      - name: local-kubernetes
        setupIngressController: false
---
kind: Module
description: cache service
name: cache-service
type: container
dockerfile: ./build/package/Dockerfile
services:
  - name: cache-service-server
    args:
      - cache-service
      - server
    ports:
      - name: grpc
        containerPort: 3000
        servicePort: 3000
    ingresses:
      - port: grpc
    env:
      REDIS_PASSWORD:
        secretRef:
          name: cache-service-secret
          key: redis-password
    dependencies:
      - redis
    healthcheck:
      httpGet:
        path: /live
        port: 8086
---
kind: Module
name: redis
description: redis server
type: helm
chart: stable/redis
values:
  existingSecret: cache-service-secret
  usePasswordFile: true
  usePassword: true
---
kind: Module
name: cache-service-secret
description: secrets for the cache service
type: kubernetes
files:
  - ./k8s/cache-service-secret.yaml
